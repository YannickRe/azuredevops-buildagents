parameters:
- name: image_type
  displayName: Build Agent Image
  type: string
  default: ubuntu2204
  values:
  - windows2019
  - windows2022
  - ubuntu2004
  - ubuntu2204
- name: variable_group
  displayName: Variable Group
  type: string
  default: BuildAgents
- name: agent_pool
  displayName: Agent Pool
  type: string
  default: 'Host Pool - Image'

trigger: none

variables:
  - group: ${{ parameters.variable_group }}

stages:
- stage: BuildVMrunnerImageStage
  displayName: 'Build VM Runner Image'
  jobs:
  - job: buildvmrunnerimage
    template: buildagent-generation-template.yml
    parameters: 
      image_type: ${{ parameters.image_type }}
      variable_group: ${{ parameters.variable_group }}
      agent_pool: ${{ parameters.agent_pool }}

- stage: CreateGalleryVMImageVersionStage
  displayName: 'Create Gallery VM Image for ${{ parameters.image_type }}'
  jobs:
  - job: creategalleryvmimageversion 
    template: buildagent-generation-galleryvm.yml
    parameters: 
      image_type: ${{ parameters.image_type }}
      variable_group: ${{ parameters.variable_group }}
      agent_pool: ${{ parameters.agent_pool }}

